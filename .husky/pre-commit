#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

branch=$(git symbolic-ref --short HEAD 2>/dev/null || echo "")
if [ "$branch" = "main" ]; then
  echo "üö´ Commit direto na branch main √© proibido! Use uma feature branch e PR."
  exit 1
fi

# Valida√ß√£o Conventional Commits
commit_msg_file=$1
if [ -z "$commit_msg_file" ]; then
  commit_msg_file=".git/COMMIT_EDITMSG"
fi
commit_msg=$(head -n1 "$commit_msg_file")

# Regex: tipo(min√∫sculo)(escopo opcional): Descri√ß√£o (primeira mai√∫scula, sem ponto final, at√© 100 chars)
conventional_regex='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-zA-Z0-9\-]+\))?: [A-Z][^\.]{0,98}$'

if ! echo "$commit_msg" | grep -Eq "$conventional_regex"; then
  echo "‚ùå Commit inv√°lido! Use: tipo: Descri√ß√£o iniciando com mai√∫scula, sem ponto final, at√© 100 caracteres."
  echo "Exemplo: feat: Adicionar endpoint de produtos"
  exit 1
fi

exit 0
