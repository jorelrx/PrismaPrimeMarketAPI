name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [main, develop]

jobs:
  validate-pr:
    name: Validar Pull Request
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Validar TÃ­tulo do PR
      uses: amannn/action-semantic-pull-request@v5
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        types: |
          feat
          fix
          docs
          style
          refactor
          perf
          test
          build
          ci
          chore
          revert
        requireScope: false
        subjectPattern: ^[A-Z].+$
        subjectPatternError: |
          O assunto do PR deve comeÃ§ar com letra maiÃºscula.
          Exemplo: "feat: Adicionar endpoint de produtos"

    - name: Validar Commits
      uses: wagoid/commitlint-github-action@v5
      with:
        configFile: .commitlintrc.json

    - name: Adicionar Label de Tamanho
      uses: codelytv/pr-size-labeler@v1
      with:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        xs_label: 'size/xs'
        xs_max_size: '10'
        s_label: 'size/s'
        s_max_size: '100'
        m_label: 'size/m'
        m_max_size: '500'
        l_label: 'size/l'
        l_max_size: '1000'
        xl_label: 'size/xl'
        fail_if_xl: 'false'
        message_if_xl: 'Este PR Ã© muito grande. Considere dividi-lo em PRs menores.'
        files_to_ignore: '*.lock package-lock.json yarn.lock'

    - name: Comentar no PR
      if: success()
      uses: actions/github-script@v7
      with:
        script: |
          const prNumber = context.payload.pull_request.number;
          
          const message = `## âœ… PR validado com sucesso!
          
          **TÃ­tulo:** ${{ github.event.pull_request.title }}
          **Commits:** Validados com conventional commits
          **Tamanho:** Label adicionada automaticamente
          
          Todas as validaÃ§Ãµes passaram! ðŸŽ‰`;
          
          await github.rest.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: prNumber,
            body: message
          });
